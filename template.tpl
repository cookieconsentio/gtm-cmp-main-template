___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "CookieConsent.io",
  "brand": {
    "id": "github.com_cookieconsentio",
    "displayName": "cookieconsentio",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Tag for implementing the CookieConsent.io CMP",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "id",
    "displayName": "CookieConsent.io ID",
    "simpleValueType": true,
    "valueHint": "000000000000-0000-0000-0000-000000000000",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "[0-9a-fA-F]{8}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{12}"
        ]
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "hidden",
    "checkboxText": "Hidden",
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "backdrop",
    "checkboxText": "Enable backdrop",
    "simpleValueType": true,
    "defaultValue": true
  },
  {
    "type": "TEXT",
    "name": "backdrop_color",
    "displayName": "Backdrop color",
    "simpleValueType": true,
    "defaultValue": "#000000",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
        ]
      },
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "position",
    "displayName": "Position",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "top",
        "displayValue": "Top"
      },
      {
        "value": "center",
        "displayValue": "Center"
      },
      {
        "value": "bottom",
        "displayValue": "Bottom"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "center"
  },
  {
    "type": "CHECKBOX",
    "name": "functional",
    "checkboxText": "Enable functional",
    "simpleValueType": true,
    "defaultValue": true
  },
  {
    "type": "CHECKBOX",
    "name": "analytics",
    "checkboxText": "Enable analytics",
    "simpleValueType": true,
    "defaultValue": true
  },
  {
    "type": "CHECKBOX",
    "name": "marketing",
    "checkboxText": "Enable marketing",
    "simpleValueType": true,
    "defaultValue": true
  },
  {
    "type": "CHECKBOX",
    "name": "functionalDefaultChecked",
    "checkboxText": "Default activate the ‘Functional cookies’ option",
    "simpleValueType": true,
    "defaultValue": false
  },
  {
    "type": "CHECKBOX",
    "name": "analyticsDefaultChecked",
    "checkboxText": "Default activate the \u0027Analytics cookies’ option",
    "simpleValueType": true,
    "defaultValue": false
  },
  {
    "type": "CHECKBOX",
    "name": "marketingDefaultChecked",
    "checkboxText": "Default activate the \u0027Marketing cookies’ option",
    "simpleValueType": true,
    "defaultValue": false
  },
  {
    "type": "CHECKBOX",
    "name": "google_consent_mode",
    "checkboxText": "Enable Google Consent Mode",
    "simpleValueType": true,
    "defaultValue": true,
    "subParams": [
      {
        "type": "SELECT",
        "name": "defaultPreferencesStorageGranted",
        "displayName": "Default Preferences mode",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "google_consent_mode",
            "paramValue": false,
            "type": "NOT_EQUALS"
          }
        ],
        "defaultValue": "denied"
      },
      {
        "type": "SELECT",
        "name": "defaultAdStorageGranted",
        "displayName": "Default Marketing mode",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "google_consent_mode",
            "paramValue": false,
            "type": "NOT_EQUALS"
          }
        ],
        "defaultValue": "denied"
      },
      {
        "type": "SELECT",
        "name": "defaultAdUserDataGranted",
        "displayName": "Default Ad User Data mode",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "google_consent_mode",
            "paramValue": false,
            "type": "NOT_EQUALS"
          }
        ],
        "defaultValue": "denied"
      },
      {
        "type": "SELECT",
        "name": "defaultAdPersonalizationGranted",
        "displayName": "Default Ad Personalization mode",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "google_consent_mode",
            "paramValue": false,
            "type": "NOT_EQUALS"
          }
        ],
        "defaultValue": "denied"
      },
      {
        "type": "SELECT",
        "name": "defaultAnalyticsStorageGranted",
        "displayName": "Default Statistics mode",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "google_consent_mode",
            "paramValue": false,
            "type": "NOT_EQUALS"
          }
        ],
        "defaultValue": "denied"
      },
      {
        "type": "SELECT",
        "name": "defaultSecurityStorageGranted",
        "displayName": "Default Security storage mode",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "denied",
            "displayValue": "Denied"
          },
          {
            "value": "granted",
            "displayValue": "Granted"
          }
        ],
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "google_consent_mode",
            "paramValue": false,
            "type": "NOT_EQUALS"
          }
        ],
        "defaultValue": "granted"
      },
      {
        "type": "TEXT",
        "name": "wait_for_update",
        "displayName": "Wait for update",
        "simpleValueType": true,
        "defaultValue": 2000,
        "enablingConditions": [
          {
            "paramName": "google_consent_mode",
            "paramValue": false,
            "type": "NOT_EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          },
          {
            "type": "NUMBER"
          }
        ]
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "hiddenHorizontalRule",
    "checkboxText": "Hide horizontal rule",
    "simpleValueType": true,
    "help": "Show or hide the horizontal rule in the consent screen"
  },
  {
    "type": "TEXT",
    "name": "font",
    "displayName": "Font family",
    "simpleValueType": true,
    "help": "Determine the font family of the consent. Font family must be made available in the browser (for example Verdana)."
  },
  {
    "type": "TEXT",
    "name": "button1Color",
    "displayName": "Button 1 Color",
    "simpleValueType": true,
    "help": "Determine the color of the ‘Allow all’ button. Value must be a hexidecimal color code (for example #1ab530).",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "button2Color",
    "displayName": "Button 2 Color",
    "simpleValueType": true,
    "help": "Determine the color of the ‘Cookie settings’ button. Value must be a hexidecimal color code (for example #b1b3b1).",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "button3Color",
    "displayName": "Button 3 Color",
    "simpleValueType": true,
    "help": "Determine the color of the ‘Save settings’ button. Value must be a hexidecimal color code (for example #000000).",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "button4Color",
    "displayName": "Button 4 Color",
    "simpleValueType": true,
    "help": "Determine the color of the ‘Reject’ button. Value must be a hexidecimal color code (for example #000000).",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "pillColor",
    "displayName": "Pill Color",
    "simpleValueType": true,
    "help": "Determine the color of the ‘Pill’ buttons in the setting screen. Value must be a hexidecimal color code (for example #000000).",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "headerSize",
    "displayName": "Header font size",
    "simpleValueType": true,
    "help": "Determine the font size of the header in pixels. Value must be an integer.",
    "valueValidators": [
      {
        "type": "POSITIVE_NUMBER"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "subheaderSize",
    "displayName": "Subheader font size",
    "simpleValueType": true,
    "help": "Determine the font size of the subheader in pixels. Value must be an integer.",
    "valueValidators": [
      {
        "type": "POSITIVE_NUMBER"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "bodySize",
    "displayName": "Body font size",
    "simpleValueType": true,
    "help": "Determine the font size of the body text in pixels. Value must be an integer.",
    "valueValidators": [
      {
        "type": "POSITIVE_NUMBER"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "alwaysActiveSize",
    "displayName": "Always active label font size",
    "simpleValueType": true,
    "help": "Determine the font size of the Always active option in pixels. Value must be an integer.",
    "valueValidators": [
      {
        "type": "POSITIVE_NUMBER"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "consentHeight",
    "displayName": "Consent window height",
    "simpleValueType": true,
    "help": "Determine the height of the consent window in pixels. Value must be an integer.",
    "valueValidators": [
      {
        "type": "POSITIVE_NUMBER"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "titleTransform",
    "displayName": "Transform titles",
    "selectItems": [
      {
        "value": "none",
        "displayValue": "None"
      },
      {
        "value": "capitalize",
        "displayValue": "Capitalize"
      },
      {
        "value": "uppercase",
        "displayValue": "Uppercase"
      },
      {
        "value": "lowercase",
        "displayValue": "Lowercase"
      }
    ],
    "simpleValueType": true,
    "notSetText": "Default"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const encodeUriComponent = require('encodeUriComponent');
const setDefaultConsentState = require('setDefaultConsentState');
const getCookieValues = require('getCookieValues');

function boolToString(value) {
    if(value) {
       return 'true';
    }
  
    return 'false';
} 

function addToURL(url, data, key) {
  if (typeof data[key] !== 'undefined') {
     url = url + '&' + encodeUriComponent(key) + '=' + encodeUriComponent(data[key]);
  }
  
  return url;
}

let url = 'https://edge.cookieconsent.io/prod/js/' + encodeUriComponent(data.id) + '.js?hidden=' + encodeUriComponent(boolToString(data.hidden)) + '&backdrop=' + encodeUriComponent(boolToString(data.backdrop)) + '&backdrop_color=' + encodeUriComponent(data.backdrop_color) + '&position=' + encodeUriComponent(data.position) + '&functional=' + encodeUriComponent(boolToString(data.functional)) + '&marketing=' + encodeUriComponent(boolToString(data.marketing)) + '&analytics=' + encodeUriComponent(boolToString(data.analytics)) + '&google_consent_mode=' + encodeUriComponent(boolToString(data.google_consent_mode)) + '&analyticsDefaultChecked=' + 
encodeUriComponent(boolToString(data.analyticsDefaultChecked)) + '&functionalDefaultChecked=' + 
encodeUriComponent(boolToString(data.functionalDefaultChecked)) + '&marketingDefaultChecked=' + 
encodeUriComponent(boolToString(data.marketingDefaultChecked)) + '&hiddenHorizontalRule=' + encodeUriComponent(boolToString(data.hiddenHorizontalRule));

//Add optional fields
url = addToURL(url, data, 'font');
url = addToURL(url, data, 'button1Color');
url = addToURL(url, data, 'button2Color');
url = addToURL(url, data, 'button3Color');
url = addToURL(url, data, 'button4Color');
url = addToURL(url, data, 'headerSize');
url = addToURL(url, data, 'subheaderSize');
url = addToURL(url, data, 'bodySize');

url = addToURL(url, data, 'titleTransform');
url = addToURL(url, data, 'consentHeight');
url = addToURL(url, data, 'alwaysActiveSize');
url = addToURL(url, data, 'pillColor');

url = addToURL(url, data, 'defaultAnalyticsStorageGranted');
url = addToURL(url, data, 'defaultAdStorageGranted');
url = addToURL(url, data, 'defaultPreferencesStorageGranted');
url = addToURL(url, data, 'defaultSecurityStorageGranted');
url = addToURL(url, data, 'defaultAdUserDataGranted');
url = addToURL(url, data, 'defaultAdPersonalizationGranted');

if (queryPermission('inject_script', url)) {
  
  // becomes
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);
    
  if(boolToString(data.google_consent_mode) == 'true') {
    
    const settings = getCookieValues('cookie-consent-io');
      
    if(settings.length > 0) {
                
      settings.forEach(cookies => {
    
      cookies = cookies.split(',');
        
          cookies.forEach(type => {
      
      if(type == 'essential') {      
          data.defaultSecurityStorageGranted = 'granted';
      }
            
      if(type == 'marketing') {      
          data.defaultAdStorageGranted = 'granted';
          data.defaultAdUserDataGranted = 'granted';
          data.defaultAdPersonalizationGranted = 'granted';        
      }
      
      if(type == 'analytics') {   
          data.defaultAnalyticsStorageGranted = 'granted';
      }
         
      if(type == 'functional') {
          data.defaultPreferencesStorageGranted = 'granted';
      }            
            
          });
      });
    }   
    
    const consentState = {
    'security_storage': data.defaultSecurityStorageGranted,      
    'functionality_storage': data.defaultPreferencesStorageGranted,
    'personalization_storage': data.defaultPreferencesStorageGranted,  
    'ad_user_data': data.defaultAdUserDataGranted,
    'ad_personalization': data.defaultAdPersonalizationGranted,
    'ad_storage': data.defaultAdStorageGranted,
    'analytics_storage': data.defaultAnalyticsStorageGranted,
    'wait_for_update': data.wait_for_update
    };
    
    setDefaultConsentState(consentState);
    
   }     
  
  // Roep data.gtmOnSuccess aan wanneer de tag is voltooid.
  data.gtmOnSuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://edge.cookieconsent.io/prod/js/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "cookie-consent-io"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 10/23/2020, 9:08:00 AM

